<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GhostLedger — Claim Status Portal</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0e14;--surface:#161b22;--border:#21262d;--border-light:#30363d;
  --text:#e6edf3;--text-muted:#8b949e;--text-dim:#484f58;
  --primary:#d2a8ff;--primary-muted:rgba(210,168,255,.12);
  --success:#4ade80;--success-muted:rgba(74,222,128,.12);
  --warning:#f0ad4e;--warning-muted:rgba(240,173,78,.12);
  --danger:#f85149;--danger-muted:rgba(248,81,73,.12);
  --blue:#58a6ff;--blue-muted:rgba(88,166,255,.12);
}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;min-height:100vh;display:flex;flex-direction:column}
a{color:var(--blue);text-decoration:none}
a:hover{text-decoration:underline}

/* Header */
.header{background:var(--surface);border-bottom:1px solid var(--border);padding:16px 24px;display:flex;align-items:center;gap:12px}
.header .logo{font-size:20px;font-weight:800;color:var(--primary);letter-spacing:-.3px}
.header .logo span{color:var(--text-muted);font-weight:400;font-size:14px;margin-left:8px}
.header .badge{background:var(--primary-muted);color:var(--primary);font-size:10px;font-weight:700;padding:3px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px}

/* Main */
.main{flex:1;display:flex;justify-content:center;padding:40px 20px}
.container{width:100%;max-width:640px}

/* Lookup Form */
.lookup-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:32px;text-align:center}
.lookup-card h1{font-size:22px;font-weight:700;margin-bottom:6px}
.lookup-card p{color:var(--text-muted);font-size:14px;margin-bottom:24px;line-height:1.5}
.form-group{text-align:left;margin-bottom:16px}
.form-group label{display:block;font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
.form-group input{width:100%;padding:12px 16px;background:var(--bg);border:1px solid var(--border-light);border-radius:10px;color:var(--text);font-size:15px;transition:border .2s}
.form-group input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-muted)}
.form-group input::placeholder{color:var(--text-dim)}
.btn-lookup{width:100%;padding:14px;background:var(--primary);color:var(--bg);border:none;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer;transition:opacity .2s,transform .1s}
.btn-lookup:hover{opacity:.9}
.btn-lookup:active{transform:scale(.98)}
.btn-lookup:disabled{opacity:.5;cursor:not-allowed}
.error-msg{color:var(--danger);font-size:13px;margin-top:12px;display:none}

/* Results */
.results{display:none;margin-top:24px}

/* Status Card */
.status-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:16px}
.status-card-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.status-card-header .claim-id{font-family:'SF Mono',Consolas,monospace;color:var(--blue);font-size:13px;font-weight:600}
.status-card-header .status-badge{padding:4px 12px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.status-badge.filed{background:var(--blue-muted);color:var(--blue)}
.status-badge.under_review,.status-badge.awaiting_review{background:var(--warning-muted);color:var(--warning)}
.status-badge.escalated{background:var(--danger-muted);color:var(--danger)}
.status-badge.in_resolution{background:var(--primary-muted);color:var(--primary)}
.status-badge.resolved,.status-badge.closed{background:var(--success-muted);color:var(--success)}
.status-badge.appealed{background:var(--warning-muted);color:var(--warning)}

/* Progress Tracker */
.progress-tracker{padding:24px;border-bottom:1px solid var(--border)}
.progress-steps{display:flex;align-items:center;justify-content:space-between;position:relative;margin-bottom:8px}
.progress-steps::before{content:'';position:absolute;top:14px;left:24px;right:24px;height:2px;background:var(--border-light)}
.progress-step{display:flex;flex-direction:column;align-items:center;position:relative;z-index:1}
.step-dot{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;border:2px solid var(--border-light);background:var(--bg);color:var(--text-dim);margin-bottom:6px;transition:all .3s}
.step-dot.active{border-color:var(--primary);background:var(--primary);color:var(--bg)}
.step-dot.completed{border-color:var(--success);background:var(--success);color:var(--bg)}
.step-label{font-size:10px;color:var(--text-dim);text-transform:uppercase;letter-spacing:.3px;font-weight:600}
.step-label.active{color:var(--primary)}
.step-label.completed{color:var(--success)}

/* Info Grid */
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:1px;background:var(--border)}
.info-item{background:var(--surface);padding:14px 20px}
.info-item .info-label{font-size:10px;color:var(--text-dim);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.info-item .info-value{font-size:14px;color:var(--text);font-weight:500}
.info-item.full{grid-column:1/-1}

/* Status Explanation */
.status-explain{padding:20px 24px;background:linear-gradient(135deg,var(--primary-muted),transparent);border-bottom:1px solid var(--border)}
.status-explain p{font-size:13px;color:var(--text-muted);line-height:1.6}
.status-explain p strong{color:var(--text)}

/* SLA Card */
.sla-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 20px;margin-bottom:16px}
.sla-card h3{font-size:13px;color:var(--blue);margin-bottom:8px;font-weight:600}
.sla-card .sla-message{font-size:13px;color:var(--text-muted);line-height:1.5}

/* Settlement Offers */
.offers-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px}
.offers-card h3{font-size:13px;color:var(--warning);margin-bottom:12px;font-weight:600}
.offer-item{padding:12px;background:var(--bg);border:1px solid var(--border-light);border-radius:10px;margin-bottom:8px}
.offer-item:last-child{margin-bottom:0}
.offer-type{font-size:10px;font-weight:700;text-transform:uppercase;color:var(--blue);letter-spacing:.5px;margin-bottom:4px}
.offer-amount{font-size:20px;font-weight:800;color:var(--text);margin-bottom:4px}
.offer-by{font-size:11px;color:var(--text-dim)}
.offer-terms{font-size:12px;color:var(--text-muted);margin-top:6px;padding-top:6px;border-top:1px solid var(--border);line-height:1.4}
.offer-deadline{font-size:11px;color:var(--warning);margin-top:4px}

/* Resolution Card */
.resolution-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;border-left:4px solid var(--success)}
.resolution-card h3{font-size:13px;color:var(--success);margin-bottom:12px;font-weight:600}
.resolution-type{font-size:11px;font-weight:700;text-transform:uppercase;color:var(--primary);letter-spacing:.5px;margin-bottom:8px}
.resolution-amount{font-size:24px;font-weight:800;color:var(--success);margin-bottom:4px}
.resolution-claimed{font-size:12px;color:var(--text-dim)}
.resolution-terms{font-size:13px;color:var(--text-muted);margin-top:10px;padding-top:10px;border-top:1px solid var(--border);line-height:1.5}

/* Next Steps */
.next-steps{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px}
.next-steps h3{font-size:13px;color:var(--primary);margin-bottom:10px;font-weight:600}
.next-steps ul{list-style:none;padding:0}
.next-steps li{font-size:13px;color:var(--text-muted);padding:6px 0 6px 20px;position:relative;line-height:1.5}
.next-steps li::before{content:'\2192';position:absolute;left:0;color:var(--primary)}

/* Disclaimer */
.disclaimer{text-align:center;padding:20px;font-size:11px;color:var(--text-dim);line-height:1.5;max-width:500px;margin:0 auto}

/* Footer */
.footer{text-align:center;padding:20px;border-top:1px solid var(--border);font-size:12px;color:var(--text-dim)}

/* Loading */
.spinner{display:inline-block;width:18px;height:18px;border:2px solid var(--primary-muted);border-top-color:var(--primary);border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes spin{to{transform:rotate(360deg)}}

/* Mobile */
@media(max-width:600px){
  .main{padding:20px 12px}
  .lookup-card{padding:24px 16px}
  .info-grid{grid-template-columns:1fr}
  .progress-steps{gap:4px}
  .step-label{font-size:8px}
}
</style>
</head>
<body>

<div class="header">
  <div class="logo">GhostLedger <span>Claim Status Portal</span></div>
  <div class="badge">Public Access</div>
</div>

<div class="main">
  <div class="container">

    <!-- LOOKUP FORM -->
    <div class="lookup-card" id="lookupCard">
      <h1>Check Your Claim Status</h1>
      <p>Enter your claim ID and the email address you used when filing to view the current status of your claim.</p>
      <div class="form-group">
        <label>Claim ID</label>
        <input type="text" id="inputClaimId" placeholder="e.g. clm_6de74f128e6b" autocomplete="off">
      </div>
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="inputEmail" placeholder="your@email.com" autocomplete="email">
      </div>
      <button class="btn-lookup" id="btnLookup" onclick="lookupClaim()">Look Up My Claim</button>
      <div class="error-msg" id="errorMsg"></div>
    </div>

    <!-- RESULTS -->
    <div class="results" id="resultsSection">
      <div id="resultsContent"></div>
      <button class="btn-lookup" style="background:transparent;border:1px solid var(--border-light);color:var(--text-muted);margin-top:8px" onclick="resetForm()">&#x2190; Look Up Another Claim</button>
    </div>

    <div class="disclaimer">
      This portal provides informational status updates only. Claim statuses reflect the current state in our coordination system. Nothing on this page constitutes legal advice, a guarantee of outcome, or an attorney-client relationship. For questions, contact <a href="mailto:support@ghostledger.io">support@ghostledger.io</a>.
    </div>

  </div>
</div>

<div class="footer">
  GhostLedger &bull; Internet Justice Infrastructure &bull; Consumer Financial Protection Coordination
</div>

<script>
const API_BASE = window.location.origin;

async function lookupClaim(){
  const claimId = document.getElementById('inputClaimId').value.trim();
  const email = document.getElementById('inputEmail').value.trim();
  const errorEl = document.getElementById('errorMsg');
  const btn = document.getElementById('btnLookup');

  errorEl.style.display = 'none';
  if(!claimId || !email){
    errorEl.textContent = 'Please enter both your claim ID and email address.';
    errorEl.style.display = 'block';
    return;
  }

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Looking up...';

  try {
    const r = await fetch(API_BASE + '/v1/lookup', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({claim_id: claimId, email: email})
    });

    if(!r.ok){
      const err = await r.json().catch(() => ({}));
      throw new Error(err.detail || 'Claim not found. Please verify your claim ID and email address.');
    }

    const data = await r.json();
    renderResults(data);
  } catch(e){
    errorEl.textContent = e.message;
    errorEl.style.display = 'block';
  } finally {
    btn.disabled = false;
    btn.textContent = 'Look Up My Claim';
  }
}

function esc(s){ return s ? String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') : ''; }

function renderResults(data){
  document.getElementById('lookupCard').style.display = 'none';
  const results = document.getElementById('resultsSection');
  const content = document.getElementById('resultsContent');
  results.style.display = 'block';

  let html = '';

  // Status Card
  html += '<div class="status-card">';
  html += '<div class="status-card-header">';
  html += '<span class="claim-id">' + esc(data.claim_id) + '</span>';
  html += '<span class="status-badge ' + data.status + '">' + data.status.replace(/_/g, ' ') + '</span>';
  html += '</div>';

  // Progress Tracker
  html += '<div class="progress-tracker"><div class="progress-steps">';
  const steps = data.status_progress.steps;
  const current = data.status_progress.current;
  steps.forEach((step, i) => {
    const cls = i < current ? 'completed' : (i === current ? 'active' : '');
    const icon = i < current ? '\u2713' : (i + 1);
    html += '<div class="progress-step">';
    html += '<div class="step-dot ' + cls + '">' + icon + '</div>';
    html += '<div class="step-label ' + cls + '">' + step + '</div>';
    html += '</div>';
  });
  html += '</div></div>';

  // Status Explanation
  html += '<div class="status-explain"><p>' + esc(data.status_label) + '</p></div>';

  // Info Grid
  html += '<div class="info-grid">';
  html += '<div class="info-item"><div class="info-label">Claimant</div><div class="info-value">' + esc(data.claimant_name) + '</div></div>';
  html += '<div class="info-item"><div class="info-label">Respondent</div><div class="info-value">' + esc(data.respondent) + '</div></div>';
  html += '<div class="info-item"><div class="info-label">Amount Claimed</div><div class="info-value">$' + (data.amount_claimed_usd || 0).toLocaleString() + '</div></div>';
  html += '<div class="info-item"><div class="info-label">Filed</div><div class="info-value">' + (data.filed_at ? new Date(data.filed_at).toLocaleDateString('en-US', {year:'numeric',month:'long',day:'numeric'}) : '—') + '</div></div>';
  html += '</div>';
  html += '</div>';

  // SLA Timeline
  if(data.sla){
    html += '<div class="sla-card">';
    html += '<h3>\u23F1 Expected Timeline</h3>';
    html += '<div class="sla-message">' + esc(data.sla.message) + '</div>';
    html += '</div>';
  }

  // Resolution
  if(data.resolution){
    html += '<div class="resolution-card">';
    html += '<h3>\u2705 Resolution</h3>';
    html += '<div class="resolution-type">' + esc(data.resolution.type) + '</div>';
    html += '<div class="resolution-amount">$' + (data.resolution.amount_settled || 0).toLocaleString() + '</div>';
    html += '<div class="resolution-claimed">of $' + (data.amount_claimed_usd || 0).toLocaleString() + ' claimed</div>';
    if(data.resolution.terms) html += '<div class="resolution-terms">' + esc(data.resolution.terms) + '</div>';
    html += '</div>';
  }

  // Pending Offers
  if(data.pending_offers && data.pending_offers.length > 0){
    html += '<div class="offers-card">';
    html += '<h3>\u1F4CB Pending Settlement Offers</h3>';
    data.pending_offers.forEach(o => {
      html += '<div class="offer-item">';
      html += '<div class="offer-type">' + esc(o.offer_type) + '</div>';
      html += '<div class="offer-amount">$' + (o.amount_offered || 0).toLocaleString() + '</div>';
      html += '<div class="offer-by">Offered by: ' + esc(o.offered_by) + ' &bull; ' + new Date(o.created_at).toLocaleDateString() + '</div>';
      if(o.terms) html += '<div class="offer-terms">' + esc(o.terms) + '</div>';
      if(o.response_deadline) html += '<div class="offer-deadline">Response deadline: ' + new Date(o.response_deadline).toLocaleDateString() + '</div>';
      html += '</div>';
    });
    html += '<div style="margin-top:10px;font-size:12px;color:var(--text-dim);line-height:1.4">To respond to a settlement offer, please contact us at <a href="mailto:support@ghostledger.io">support@ghostledger.io</a> with your claim ID.</div>';
    html += '</div>';
  }

  // Recovery
  if(data.recovery){
    html += '<div class="sla-card" style="border-left:3px solid var(--success)">';
    html += '<h3 style="color:var(--success)">\u1F4B0 Recovery Progress</h3>';
    html += '<div style="font-size:20px;font-weight:800;color:var(--success)">$' + (data.recovery.amount_recovered || 0).toLocaleString() + '</div>';
    html += '<div style="font-size:12px;color:var(--text-dim)">recovered so far</div>';
    html += '</div>';
  }

  // Next Steps
  if(data.next_steps && data.next_steps.length > 0){
    html += '<div class="next-steps">';
    html += '<h3>\u27A1 Next Steps</h3>';
    html += '<ul>';
    data.next_steps.forEach(s => { html += '<li>' + esc(s) + '</li>'; });
    html += '</ul>';
    html += '</div>';
  }

  content.innerHTML = html;
}

function resetForm(){
  document.getElementById('lookupCard').style.display = '';
  document.getElementById('resultsSection').style.display = 'none';
  document.getElementById('inputClaimId').value = '';
  document.getElementById('inputEmail').value = '';
  document.getElementById('errorMsg').style.display = 'none';
}

// Allow Enter key to submit
document.addEventListener('keydown', e => {
  if(e.key === 'Enter' && document.getElementById('lookupCard').style.display !== 'none'){
    lookupClaim();
  }
});
</script>
</body>
</html>
